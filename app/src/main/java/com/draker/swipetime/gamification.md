# Реализация системы геймификации в SwipeTime

## Выполненные задачи

1. **Создание таблиц для хранения опыта, уровней и достижений**
   - Используются сущности: UserEntity, UserStatsEntity, AchievementEntity, UserAchievementCrossRef
   - Обеспечено хранение прогресса по каждому типу действия

2. **Реализация начисления опыта за действия**
   - Свайпы (влево/вправо)
   - Оценки контента
   - Написание рецензий
   - Отметки о просмотре/прочтении

3. **Создание системы уровней с формулой расчета опыта**
   - Формула: 100 * уровень^2
   - Процент прогресса к следующему уровню
   - Ранги пользователей в зависимости от уровня

4. **Добавление базового набора достижений**
   - Достижения для начинающих
   - Промежуточные достижения
   - Продвинутые достижения
   - Достижения за дни активности

5. **Реализация уведомлений о достижениях**
   - Системные уведомления с иконками
   - Всплывающие сообщения (Toast)
   - Логирование в консоль

## Архитектура системы геймификации

### Основные компоненты:

1. **GamificationManager** - основной класс для управления опытом, уровнями и достижениями
   - Обрабатывает действия пользователя
   - Проверяет выполнение достижений
   - Начисляет опыт

2. **XpLevelCalculator** - утилитный класс для расчета уровней и опыта
   - Определяет необходимый опыт для каждого уровня
   - Вычисляет текущий уровень на основе опыта
   - Рассчитывает прогресс к следующему уровню

3. **AchievementNotifier** - отображает уведомления о новых достижениях
   - Показывает системные уведомления
   - Реализует интерфейс OnAchievementListener

4. **GamificationIntegrator** - класс для удобной интеграции геймификации
   - Содержит статические методы для регистрации различных действий
   - Единый интерфейс для всех компонентов приложения

5. **GamificationViewModel** - ViewModel для управления геймификацией на уровне UI
   - Загружает данные пользователя и статистику
   - Обрабатывает действия и обновляет LiveData
   - Обеспечивает наблюдение за изменениями данных

6. **ActionLogger** - утилитный класс для логирования действий пользователя
   - Записывает все действия пользователя в лог с подробностями
   - Помогает в отладке и анализе поведения пользователя

### Интеграция в основные компоненты приложения:

- **CardStackFragment** - начисление опыта за свайпы
- **DetailLikedContentFragment** - начисление опыта за оценки, рецензии и просмотр
- **ProfileFragment** - отображение статистики и тестовые действия
- **SwipeTimeApplication** - инициализация системы геймификации при запуске
- **MainActivity** - инициализация и настройка компонентов

## Процесс начисления опыта

1. Пользователь выполняет действие (свайп, оценка, написание рецензии и т.д.)
2. Компонент приложения вызывает соответствующий метод GamificationIntegrator
3. GamificationIntegrator вызывает GamificationManager.processUserAction
4. GamificationManager:
   - Обновляет статистику пользователя
   - Начисляет опыт на основе действия
   - Проверяет выполнение достижений
   - Отслеживает повышение уровня
5. Если выполнено достижение или повышен уровень:
   - AchievementNotifier показывает уведомление
   - Пользователь получает дополнительный опыт за достижение

## Формула расчета опыта для уровней

- Опыт для уровня: 100 * уровень^2
- Уровень на основе опыта: sqrt(опыт / 100)
- Опыт за действия:
  - Свайп: 5 XP
  - Оценка: 15 XP
  - Рецензия: 30 XP
  - Просмотр/прочтение: 10 XP
  - Достижение: зависит от сложности (от 10 до 1000 XP)

## Система достижений

Достижения разделены на несколько категорий:
- **Начинающий (BEGINNER)** - простые достижения для новых пользователей
- **Средний (INTERMEDIATE)** - достижения среднего уровня сложности
- **Продвинутый (ADVANCED)** - сложные достижения для активных пользователей
- **Эксперт (EXPERT)** - достижения для самых преданных пользователей
- **Коллекционер (COLLECTOR)** - достижения за сбор контента определенного типа
- **Социальный (SOCIAL)** - достижения за социальные взаимодействия
- **Постоянство (STREAK)** - достижения за регулярное использование приложения

## Система уровней и рангов

Звания пользователей в зависимости от уровня:
- Уровни 1-4: "Новичок"
- Уровни 5-9: "Энтузиаст"
- Уровни 10-19: "Ценитель"
- Уровни 20-29: "Эксперт"
- Уровни 30-49: "Критик"
- Уровни 50-74: "Мастер"
- Уровни 75-100: "Легенда"

## Статистика пользователя

Для каждого пользователя отслеживается:
- Общее количество свайпов
- Количество свайпов вправо/влево
- Количество оценок
- Количество рецензий
- Количество просмотренного/прочитанного контента
- Общее количество действий
- Количество дней подряд с активностью (streak)
- Дата последней активности
- Количество полученных достижений

## Кеширование и синхронизация

- Все данные геймификации хранятся локально в SQLite через Room
- В будущих версиях планируется добавить синхронизацию с облаком через Firebase

## Дальнейшие улучшения

1. **Расширенная система достижений**
   - Достижения за определенные жанры
   - Сезонные достижения
   - Секретные достижения

2. **Улучшенная система наград**
   - Виртуальные предметы за достижения
   - Разблокировка дополнительных функций

3. **Социальные элементы**
   - Сравнение прогресса с друзьями
   - Лидерборды и рейтинги

4. **Система задач**
   - Ежедневные задания
   - Еженедельные испытания

5. **Персонализация рекомендаций**
   - Использование статистики для улучшения рекомендаций
   - Адаптация контента на основе предпочтений

## Инструкции по интеграции в новые компоненты

Для добавления геймификации в новый функционал приложения:

1. Импортируйте GamificationIntegrator:
```java
import com.draker.swipetime.utils.GamificationIntegrator;
```

2. Используйте соответствующий метод для регистрации действия:
```java
// Для свайпа
boolean levelUp = GamificationIntegrator.registerSwipe(context, true, contentId, contentTitle);

// Для оценки
boolean levelUp = GamificationIntegrator.registerRating(context, contentId, contentTitle, rating);

// Для рецензии
boolean levelUp = GamificationIntegrator.registerReview(context, contentId, contentTitle);

// Для просмотра/прочтения
boolean levelUp = GamificationIntegrator.registerCompletion(context, contentId, contentTitle, contentType);
```

3. При необходимости, отреагируйте на повышение уровня:
```java
if (levelUp) {
    Toast.makeText(context, "Уровень повышен!", Toast.LENGTH_SHORT).show();
}
```

4. Для отображения данных геймификации используйте GamificationViewModel:
```java
GamificationViewModel viewModel = new ViewModelProvider(this).get(GamificationViewModel.class);
viewModel.getCurrentUser().observe(getViewLifecycleOwner(), user -> {
    // Обновление UI с данными пользователя
});
```
